(jbuild_version 1)

; @todo Use cppo on all source files:
; (preprocess (action (run ${bin:cppo} -V OCAML:${ocaml_version} ${<})))
; as documented in http://jbuilder.readthedocs.io/en/latest/quick-start.html#using-cppo
(rule (
  (targets (Testing.ml))
  (deps (Testing.cppo.ml))
  (action (run ${bin:cppo} -V OCAML:${ocaml_version} ${<} -o ${@}))
))

(library (
  (name Reset_)
  (modules (Reset_))
  (libraries (Reset))
  (flags (:standard -nopervasives -w @A))
))

(library (
  (name Pervasives_)
  (modules (Pervasives_))
  (libraries (Foundations))
  (flags (:standard -nopervasives -w @A))
))

(library (
  (name Testing)
  (modules (Testing))
  (libraries (Foundations Pervasives_))
  (flags (:standard -nopervasives -w @A-4-44-48 -open Pervasives_))
))

(library (
  (name General)
;  (public_name General)
;  (preprocess (pps (bisect_ppx)))
  (modules (General))
  (libraries (num Foundations Traits Concepts Implementation Specializations))
  (flags (:standard -nopervasives -w @A -open Pervasives_))
))

(executable (
  (name unit_tests)
  (modules (unit_tests))
  (libraries (General))
  (flags (:standard -w @A-44 -open Pervasives_))
))

(alias (
  (name runtest)
  (deps (unit_tests.bc))
  (action (run ${exe:unit_tests.bc}))
))
